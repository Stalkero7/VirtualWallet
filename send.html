<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Alke Wallet - Enviar</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        .shake { animation: shake 0.5s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
    </style>
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div id="card-send" class="card p-4 mx-auto shadow" style="max-width: 450px;">
            <h3>Enviar Dinero</h3>
            <div class="alert alert-secondary">Saldo: <b id="current-s">$0</b></div>
            
            <label>Destinatario</label>
            <select id="select-dest" class="form-control mb-3">
                <option value="">-- Seleccionar contacto --</option>
            </select>

            <label>Monto a enviar</label>
            <input type="number" id="monto-e" class="form-control mb-4" placeholder="0">

            <button id="btn-env" class="btn btn-primary btn-block">Confirmar EnvÃ­o</button>
            <a href="contacts.html" class="btn btn-outline-secondary btn-block btn-outline-dark btn-primary">Agregar Destinatario</a>
            <a href="index.html" class="btn btn-link btn-block btn-outline-danger">Cancelar</a>
        </div>
    </div>
    <script>
        $(document).ready(function() {
            let saldo = parseInt(localStorage.getItem('saldo')) || 0;
            $('#current-s').text('$' + saldo.toLocaleString('es-CL'));

            // Cargar contactos al selector
            let contactos = JSON.parse(localStorage.getItem('contactos')) || [];
            contactos.forEach(c => $('#select-dest').append(`<option value="${c.nombre}">${c.nombre}</option>`));

            $('#btn-env').click(function() {
                let monto = parseInt($('#monto-e').val());
                let dest = $('#select-dest').val();

                if (!dest || isNaN(monto) || monto <= 0) {
                    $('#card-send').addClass('shake');
                    setTimeout(() => $('#card-send').removeClass('shake'), 500);
                    alert("âŒ Datos no vÃ¡lidos."); return;
                }

                if (monto > saldo) {
                    alert("ðŸš« Saldo insuficiente."); return;
                }

                localStorage.setItem('saldo', saldo - monto);
                let h = JSON.parse(localStorage.getItem('historial')) || [];
                h.push({ fechaHora: new Date().toLocaleString(), tipo: 'Transferencia', nombre: dest, monto: monto });
                localStorage.setItem('historial', JSON.stringify(h));

                alert("âœ… EnvÃ­o exitoso.");
                window.location.href = "index.html";
            });
        });
    </script>
</body>
</html>